# Configuration file for the ComCam

# The name of the HeaderService
hs_name: CCHeaderService
instrument: ComCam
# Vendor names should come from an CCCamera Event in the future
vendor_names: ['ITL','ITL','ITL','ITL','ITL','ITL','ITL','ITL','ITL','ITL']
section: ComCam

# Default logging level
loglevel: 'INFO'

# Path to the log location and other log definitions
logfile: 'www/HeaderService.log'
log_format: '[%(asctime)s.%(msecs)03d][%(levelname)s][%(name)s][%(funcName)s] %(message)s'
log_format_date: '%Y-%m-%d %H:%M:%S'

# path to the web server logfile
weblogfile: 'www/webserver.log'

# port_number for webserver
port_number: 8000

# The URL format to be used
url_format: "http://{ip_address}:{port_number}/{filename_HDR}"

# Default write_mode (fits or string)
write_mode: yaml

# Timeout beyond the requested exposure time to wait for an end of Telemetry event (in seconds)
timeout_exptime: 30
timeout_keyword: 'EXPTIME'

# The file naming event source and definitions
filepath: 'www/DMHS_filerepo'
format_HDR: "{}.header"
format_FITS: "{}.fits"
imageName_event:
    device: CCCamera
    topic: startIntegration
    value: imageName

# The Events that we use to define where we collect
start_collection_event:
    device: CCCamera
    topic: startIntegration

end_collection_event:
    device: CCCamera
    topic: endOfImageTelemetry

# The event for the image readout paramters
imageParam_event:
    device: CCCamera
    topic: imageReadoutParameters

# Telemetry values for images meta-data
# https://confluence.lsstcorp.org/display/SYSENG/ComCam+Header+Information+Topic+Mapping
telemetry:

 DATE-OBS:
  device: CCCamera
  Stype: Event
  topic: endOfImageTelemetry
  value: timestampDateObs
  collect_after_event: end_collection_event

 DATE-BEG:
  device: CCCamera
  Stype: Event
  topic: endOfImageTelemetry
  value: timestampDateObs
  collect_after_event: end_collection_event

 DATE-END:
  device: CCCamera
  Stype: Event
  topic: endOfImageTelemetry
  value: timestampDateEnd
  collect_after_event: end_collection_event

 OBSID:
  device: CCCamera
  Stype: Event
  topic: startIntegration
  value: imageName
  collect_after_event: start_collection_event

 TELCODE:
  device: CCCamera
  Stype: Event
  topic: startIntegration
  value: imageSource
  collect_after_event: start_collection_event

 CONTRLLR:
  device: CCCamera
  Stype: Event
  topic: startIntegration
  value: imageController
  collect_after_event: start_collection_event

 DAYOBS:
  device: CCCamera
  Stype: Event
  topic: startIntegration
  value: imageDate
  collect_after_event: start_collection_event

 SEQNUM:
  device: CCCamera
  Stype: Event
  topic: startIntegration
  value: imageNumber
  collect_after_event: start_collection_event

 GROUPID:
  device: CCCamera
  Stype: Event
  topic: startIntegration
  value: groupId
  collect_after_event: start_collection_event

 IMGTYPE:
   device: CCCamera
   Stype: Event
   topic: startIntegration
   value: imageType
   collect_after_event: start_collection_event

 EXPTIME:
  device: CCCamera
  Stype: Event
  topic: startIntegration
  value: exposureTime
  collect_after_event: start_collection_event

# ---- Comment until xml is ready --------
#
# DARKTIME:
#  device: CCCamera
#  Stype: Event
#  topic: endOfImageTelemetry
#  value: darkTime
#  collect_after_event: end_collection_event
#
# SHUTTIME:
#  device: CCCamera
#  Stype: Event
#  topic: shutterMotionProfile
#  collect_after_event: end_collection_event
#
# CCDTEMP:
#  device: CCCamera
#  Stype: Telemetry
#  topic: wreb
#  value: ccdTemp0
#  array_per_CCD: True
#

# --- Camera Sensor information

 CCD_MANU:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: ccdManufacturer
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 CCD_TYPE:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: ccdType
  collect_after_event: start_collection_event
  array: CCD_array
  array_key: ccdLocation

 CCD_SERN:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: ccdManSerNum
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 LSST_NUM:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: ccdLSSTName
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 CCDSLOT:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: ccdSlot
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 RAFTBAY:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: raftBay
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 SEQCKSUM:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: sequencerChecksum
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 SEQNAME:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: sequencerKey
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 REBNAME:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: rebLSSTName
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 CONTNUM:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: rebSerialNumber
  collect_after_event: start_collection_event
  array: CCD_array_str
  array_key: ccdLocation

 TEMP_SET:
  device: CCCamera
  Stype: Event
  topic: focalPlaneSummaryInfo
  value: ccdTempSetPoint
  collect_after_event: start_collection_event
  array: CCD_array
  array_key: ccdLocation

 IMAGETAG:
  device: CCCamera
  Stype: Event
  topic: endOfImageTelemetry
  value: imageTag
  collect_after_event: end_collection_event

# --------------------------------------------------------------
 OVERH:
  device: CCCamera
  Stype: Event
  topic: imageReadoutParameters
  value: overCols
  collect_after_event: end_collection_event
  array: CCD_array
  array_key: ccdLocation

 OVERV:
  device: CCCamera
  Stype: Event
  topic: imageReadoutParameters
  value: overRows
  collect_after_event: end_collection_event
  array: CCD_array
  array_key: ccdLocation

 PREH:
  device: CCCamera
  Stype: Event
  topic: imageReadoutParameters
  value: preCols
  collect_after_event: end_collection_event
  array: CCD_array
  array_key: ccdLocation

# --- Pointing Information ---------------
 OBJECT:
  device: MTPtg
  Stype: Event
  topic: currentTarget
  value: targetName
  collect_after_event: start_collection_event

 RA:
  device: MTPtg
  Stype: Event
  topic: currentTarget
  value: ra
  collect_after_event: start_collection_event
  scale: 57.29577951308232

 DEC:
  device: MTPtg
  Stype: Event
  topic: currentTarget
  value: declination
  collect_after_event: start_collection_event
  scale: 57.29577951308232

 ROTPA:
  device: MTPtg
  Stype: Event
  topic: currentTarget
  value: rotPA
  collect_after_event: start_collection_event

 RASTART:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: ra
  collect_after_event: start_collection_event
  array: timestamp_start

 DECSTART:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: declination
  collect_after_event: start_collection_event
  array: timestamp_start

 HASTART:
  device: MTPtg
  Stype: Telemetry
  topic: currentTargetStatus
  value: ha
  collect_after_event: start_collection_event

 AMSTART:
  device: MTPtg
  Stype: Telemetry
  topic: currentTargetStatus
  value: airmass
  collect_after_event: start_collection_event

 ELSTART:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: elevationCalculatedAngle
  collect_after_event: start_collection_event
  array: timestamp_start

 AZSTART:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: azimuthCalculatedAngle
  collect_after_event: start_collection_event
  array: timestamp_start

 RAEND:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: ra
  collect_after_event: end_collection_event
  array: timestamp_start

 DECEND:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: declination
  collect_after_event: end_collection_event
  array: timestamp_start

 HAEND:
  device: MTPtg
  Stype: Telemetry
  topic: currentTargetStatus
  value: ha
  collect_after_event: end_collection_event

 AMEND:
  device: MTPtg
  Stype: Telemetry
  topic: currentTargetStatus
  value: airmass
  collect_after_event: end_collection_event

 ELEND:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: elevationCalculatedAngle
  collect_after_event: end_collection_event
  array: timestamp_start

 AZEND:
  device: MTPtg
  Stype: Telemetry
  topic: mount_positions
  value: azimuthCalculatedAngle
  collect_after_event: end_collection_event
  array: timestamp_start

 FOCUSZ:
  device: Hexapod
  device_index: 1
  Stype: Telemetry
  topic: application
  value: demand
  collect_after_event: start_collection_event
  array_index: 2
  array: indexed_array

#  TRACKSYS:
#   device: ATMCS
#   Stype: Event
#   topic: target
#   value: tracksys
#   collect_after_event: start_collection_event

#  RADESYS:
#   device: ATMCS
#   Stype: Event
#   topic: target
#   value: radesys
#   collect_after_event: start_collection_event

# # -------------------------------------------------
# # ----- Filter information from CCCamera ----------

#  FILTER:
#   device: CCCamera
#   Stype: Event
#   topic: startIntegration
#   value: name
#   collect_after_event: start_collection_event

#  FILTPOS:
#   device: CCCamera
#   Stype: Event
#   topic: startIntegration
#   value: position
#   collect_after_event: start_collection_event
