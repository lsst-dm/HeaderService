#!/usr/bin/env python
import datetime


def get_obsnite(date=None, thresh_hour=14, format='{year}{month:02d}{day:02d}'):

    import datetime
    """
    Get the obs-nite from a 'datetime.datetime.now()' kind of data object, but it will not
    work 'datetime.date.today()' has it has no hour
    """
    if date is None:
        date = datetime.datetime.now()
    # If hour < 14 we are still in the previous night date
    if date.hour < thresh_hour:
        date = date - datetime.timedelta(days=1)
    obsnite = format.format(year=date.year, month=date.month, day=date.day)
    return obsnite


obsnite = get_obsnite()
print obsnite

date = datetime.datetime(2018, 4, 3, 16, 34, 12, 95940)
obsnite = get_obsnite(date)
print obsnite
